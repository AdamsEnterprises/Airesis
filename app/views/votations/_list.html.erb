<%proposalsnumber = proposals.count
if proposalsnumber > 0 %>
<% proposals.each do |proposal| %>
<div id="proposal<%= proposal.id %>" class="blogComment" >
    <div class="proposal_list" style="float:left; width:92%;">
        <table style="padding:5px">
            <body>
                <tr>
                    <td>
                        <div class="blogUserImage">
                            <%= proposal.user_image_tag 50 %>
                        </div>
                        <td>
                            <div id="proposalcc">
                                <div class="baloon_header">
                                    <div class="blogCommentPostedAt">
                                        <h3><%= link_to proposal.title, proposal %></h3>
                                        Inserita il <span class="blogPostDate"><%= proposal.created_at.strftime("%d/%m/%Y %H:%M") %></span>
                                        da <span class="blogPoster"><%=link_to_user proposal.user %></span>
                                        <%if proposal.updated_at != nil %>
                                        (Ultima modifica del <%= proposal.updated_at.strftime("%d/%m/%Y %H:%M") %>)<%end %>                                        
                                    </div>
                                </div>
                            </div>
                        </td>
                    </td>
                </tr>
                <tr>
                    <td style="vertical-align:top; width:62px;">
                        <%= render :partial => 'fragments/votes_and_rank', :locals => {:object => proposal} %>
                    </td>
                    <td>
                    <div class="baloon-content">
                        <%=h proposal.short_content %>						<%= link_to 'continua a leggere la proposta', proposal %>
                    </div>
          
          	      </td>
                </tr>
            </body>
        </table>
    </div>
<div style="float:left">		<div>		<%= link_to '',{:controller => "votations",:action => "vote",  :proposal_id => proposal.id, :vote_type => 1},:remote => true, :id => "votered"+proposal.id.to_s, :class => "votered"  %> 	</div>	<div>		<%= link_to '',{:controller => "votations",:action => "vote",  :proposal_id => proposal.id, :vote_type => 2},:remote => true, :id => "voteyellow"+proposal.id.to_s, :class => "voteyellow", :onclick => "if (!pulsate("+proposal.id.to_s + ",'yellow',6)) return false;"  %> 	</div>	<div>		<%= link_to '',{:controller => "votations",:action => "vote",  :proposal_id => proposal.id, :vote_type => 3},:remote => true, :id => "votegreen"+proposal.id.to_s, :class => "votegreen", :onclick => "if (!pulsate("+proposal.id.to_s + ",'green',6)) return false;"  %> 	</div>                             
</div><div style="clear:both;"></div>
</div>
<% end %>
<%end %><script type="text/javascript">	var list_states = {};		/*	 * Funzione che ritorna semplicemente false, 	 * bloccando l'esecuzione delle istruzioni successive.
	 */	function donothing() {		return false;	}		/**	 * Fa pulsare un elemento.
	 */	function pulsate(proposal_id, color, times){		//semafori		var me =  $("#vote"+ color + proposal_id);		var red = $("#votered" + proposal_id);		var green = $("#votegreen" + proposal_id);		var yellow = $("#voteyellow" + proposal_id);				//se il pulsante ha gi√† finito di pulsare, prosegui con la chiamata ajax		if (list_states[proposal_id] == "pulsed")			return true;						//imposta lo stato 'sto pulsando'			list_states[proposal_id] = "pulsating";		if (times == 0) {			setTimeout(function(){				$('#proposal' + proposal_id).hide(1200, function() {					list_states[proposal_id] = "pulsed";					me.click();				});			}, 400);			return false;		}		setTimeout(function(){			if (times % 2 == 1) 				me.css('backgroundImage', 'url(images/'+color+'.png)');			else 				me.css('backgroundImage', 'url(images/'+color+'-2.png)');			pulsate(proposal_id,color, times-1);		}, 400);				//disattiva gli altri pulsanti per evitare che vengano cliccati		if (color == "red") {			disable(green);			disable(yellow);					}		else if (color == "yellow") {			disable(green);			disable(red);				}		else if (color == "green") {			disable(red);			disable(yellow);		}		return false;	}			function disable(el) {		el.removeAttr('onclick');		el.click(donothing);		el.fadeOut(2400);	}			$(function() {		//UJS. sostituisci le funzioni onclick;				$('.votered').click(function(e){			num = $(this).attr('id').replace('votered','');			if (!pulsate(num,'red',6)) {				return false;			}			return true;		});				$('.votegreen').click(function(e){			num = $(this).attr('id').replace('votegreen','');			if (!pulsate(num,'green',6)) {				return false;			}			return true;		});				$('.voteyellow').click(function(e){			num = $(this).attr('id').replace('voteyellow','');			if (!pulsate(num,'yellow',6)) {				return false;			}			return true;		});	});	</script>
