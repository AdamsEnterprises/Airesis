<%if LIMIT_PROPOSALS %>
<% max = current_user.proposals.maximum(:created_at) || Time.now - (PROPOSALS_TIME_LIMIT + 1.seconds)%>
<% elapsed = Time.now - max %>
<%if elapsed < PROPOSALS_TIME_LIMIT%>
    alert('Devono passare 2 minuti tra una proposta e l\'altra\nAttendi ancora <%= ((PROPOSALS_TIME_LIMIT - elapsed)/60).floor%> minuti e <%= ((PROPOSALS_TIME_LIMIT - elapsed)%60).round(0)%> secondi.');
<%else%>
<%end%>

$('#create_proposal_container').html('<%= escape_javascript(render(:partial => @proposal))%>');

var create_proposal_ = $('#create_proposal');
create_proposal_.dialog({
    title: '<%=escape_javascript @title%>',
    modal: true,
    width: 720,
    height: 'auto',
    close: function (event, ui) {
        create_proposal_.dialog('destroy');
        create_proposal_.remove();
        window.location.reload(); //TODO workaround se ridisegno la textarea non funziona quindi devo ricaricare la pagina
    }
});

disegnaBottoni();

//window.ClientSideValidations.forms['new_proposal'].validators['proposal[sections_attributes][][paragraphs_attributes][][content]']['presence'] = [{'message':'deve essere compilato'}];

$('#new_proposal').enableClientSideValidations();
<%end%>
