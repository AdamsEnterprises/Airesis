<p>
    <h3><%=h @group.name %></h3>
</p>
<p>
    <%=h @group.description %>
</p>
<% partecipants = @group.partecipants %>

<% requests = @group.partecipation_requests.pending
if requests.size > 0 %>
<p>
    <b>Elenco delle richieste di partecipazione in attesa di risposta</b>
</p>
<%requests.each do |request| %>
<p>
    <%=request.user.full_link_to_page %>
    <% if ((current_user && (@group.portavoce == current_user)) || is_admin?) %>
    <%if @group.request_by_vote? %>
    <%=link_to 'Accetta la richiesta e procedi con la votazione.', url_for(:action => "partecipation_request_confirm", :controller => "groups", :id => @group.id, :request_id => request.id) %>
    <%elsif @group.request_by_portavoce? %>
    <%=link_to 'Accetta la richiesta.', url_for(:action => "partecipation_request_confirm", :controller => "groups", :id => @group.id, :request_id => request.id) %>
    <% end %>
    <%end %>
</p>
<% end %>
<% voting = @group.partecipation_requests.voting
if voting.size > 0 %>
<p>
    <b>Elenco delle richieste di partecipazione in corso di votazione</b>
</p>
<%voting.each do |request| %>
<p>
    <%=request.user.full_link_to_page %>
    <a>Vota SI</a>
    - <a>Vota NO</a>
</p>
<%end
end %>
<% end %>
<% if logged_in? %>
<p>
    <% partecipation_request = current_user.has_asked_for_partecipation?(@group.id)
    if !partecipation_request %>
    <%= link_to 'Richiedi di partecipare a questo gruppo', url_for(:action => "ask_for_partecipation", :controller => "groups", :id => @group.id) %>
    <%else %>
    <b>Hai gi√† fatto richiesta di partecipazione a questo gruppo. Stato della richiesta: <%=partecipation_request.status.description %>
    </b>
    <%end %>
</p>
<%end %>
<%posts = @group.posts.all(:order => 'published_at DESC') %>
<% if posts.size == 0 %>
<div class="blogPost">
    <h1>Nessun Post</h1>
    <p>
        Non vi sono ancora Post in questo Gruppo, torna presto.
    </p>
</div>
<% else %>
<%= render :collection => posts, :partial => 'blog_posts/blog_post' %>
<% end %>
<%= link_to 'Modifica', edit_group_path(@group) if (is_admin?) %>
<%= link_to 'Indietro', groups_path %>
<script>
    
 /*   var linkActive = false;
    
    function extractId(str){
        var patt1 = "_.*";
        return str.match(patt1).toString().substr(1);
    }
    
    function handleDropEvent(event, ui){
        var draggable = ui.draggable;
        draggable.position({
            of: $(this),
            my: 'left top',
            at: 'left top',
            offset: '50 0'
        });
        draggable.draggable('option', 'revert', false);
        $.ajax({
            type: "GET",
            url: "/groups/add_portavoce/<%=@group.id%>",
            data: "portavoce_id=" + extractId(draggable.attr('id'))
        });
        
    }
    
    $(function(){
        $('.group_partecipant').draggable({
            cursor: 'move',
            containment: 'document',
            revert: true
        });
        
        
        $('#portavoce_section').droppable({
            drop: handleDropEvent
        });
    });*/
    
    var menu1 = [{
        'Option 1': function(menuItem, menu){
            alert("You clicked Option 1!");
        }
    }, $.contextMenu.separator, {
        'Option 2': function(menuItem, menu){
            alert("You clicked Option 2!");
        }
    }];
    
/*    $(document).ready(function(){
        //Tie a menu to the right click of each row of the table with a class of customerRow
        $('.Mo').contextMenu(menu1, {
            theme: 'vista'
        });
    });*/
</script>


<% content_for :left_panel do%>
<%if partecipants.length > 0 %>
<p>
    <h4>Elenco partecipanti al gruppo</h4>
    
        <%partecipants.each do |partecipant| %>
        <div class="pcontainer">
        	<div class="Mo">
				<%= partecipant.user_image_tag(24) %>
			</div>			
			<div class="Mo">
				<%=partecipant.full_link_to_page %>
			</div>
        </div>
        <%end %>
    
</p>
<%else %>

<p>
    <b>Nessun utente partecipa ancora a questo gruppo.</b>
</p>
<%end %>
<%end%>

