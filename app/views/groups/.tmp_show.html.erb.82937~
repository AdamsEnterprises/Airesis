<p>
  <h3><%=h @group.name %></h3>
</p>

<p>
  <%=h @group.description %>
</p>


	<% partecipants = @group.partecipants %>

	<%if partecipants.length > 0 %>
	
	<p>
		<b>Elenco partecipanti al gruppo</b>
		<div id="partecipanti_section" class="portavoce_section" >
					<!-- Right Click Menu -->
			<ul id="myMenu" class="contextMenu">
			    <li class="insert"><a href="#insert">Add New</a></li>        
			    <li class="edit"><a href="#edit">Edit</a></li>                    
			    <li class="delete"><a href="#delete">Delete</a></li>            
			</ul>
		<%partecipants.each do |partecipant| %>
		
		
		
			<div class="group_partecipant" id="partecipant_<%=partecipant.id%>" style="background:lightgray; height:20px; display:inline-block; border:solid 1px; border-radius:5px;padding:5px; box-shadow: 0 1px 5px #CCCCCC;">
			<a onClick="return linkActive;" href="/users/<%=partecipant.id%>"><%= h(partecipant.name) + " " +  h(partecipant.surname)  + "(" + h(partecipant.login) + ")"%></a>
			<span aria-haspopup="true" tabindex="0" title="Opzioni" class="Mo" role="button"></span>
			</div>
		<%end%>				
		</div>			
		
	</p>
	
		
	<%else%>
	<p>
		<b>Nessun utente partecipa ancora a questo gruppo.</b>
	</p>
	<%end%>
	
	
	
	<% requests = @group.partecipation_requests.pending
		if requests.size > 0 %>
			<p><b>Elenco delle richieste di partecipazione in attesa di risposta</b></p>
			<%requests.each do |request|%>
				<p><%=request.user.full_link_to_page%>
				<% if ((current_user && (@group.portavoce == current_user)) || is_admin?)%>
					<%if @group.request_by_vote?%>
						<%=link_to 'Accetta la richiesta e procedi con la votazione.', url_for(:action => "partecipation_request_confirm", :controller => "groups", :id => @group.id, :request_id => request.id)%>
					<%elsif @group.request_by_portavoce? %>
						<%=link_to 'Accetta la richiesta.', url_for(:action => "partecipation_request_confirm", :controller => "groups", :id => @group.id, :request_id => request.id)%> 
					<% end%>
				<%end%>
				</p>
	<% 	end%>
		
	<% voting = @group.partecipation_requests.voting
		if voting.size > 0%>
			<p><b>Elenco delle richieste di partecipazione in corso di votazione</b></p>
			<%voting.each do |request|%>
				<p><%=request.user.full_link_to_page%>
				<a>Vota SI</a> - 
				<a>Vota NO</a>
				</p>
			<%end
		end%>	
<% end%>	
	
<% if logged_in? %>		
	<p>
	<% partecipation_request = current_user.has_asked_for_partecipation?(@group.id)  
	if !partecipation_request%>
		<%= link_to 'Richiedi di partecipare a questo gruppo', url_for(:action => "ask_for_partecipation", :controller => "groups", :id => @group.id)%>
	<%else%>
		<b>
		Hai gi√† fatto richiesta di partecipazione a questo gruppo. Stato della richiesta: <%=partecipation_request.status.description%>
		</b>
	<%end%>
	</p>
<%end%>


<%posts = @group.posts.all(:order => 'published_at DESC')%>  
<% if posts.size == 0 %>
	<div class="blogPost">
		<h1>Nessun Post</h1>
		<p>Non vi sono ancora Post in questo Gruppo, torna presto.</p>
	</div>
<% else %>
	<%= render :collection => posts, :partial => 'blog_posts/blog_post' %>
<% end %>

<%= link_to 'Modifica', edit_group_path(@group) if (is_admin?)%>


<%= link_to 'Indietro', groups_path %>


<script>
	
	var linkActive = false;
	
function extractId(str) {	
	var patt1="_.*";
	return str.match(patt1).toString().substr(1);
}
	
function handleDropEvent( event, ui ) {
  var draggable = ui.draggable;
  /*draggable.draggable( 'disable' );*/
  /*$(this).droppable( 'disable' );*/
  draggable.position( { of: $(this), 
  						my: 'left top', 
						at: 'left top',
						offset: '50 0' } );
  draggable.draggable( 'option', 'revert', false );
  $.ajax({
 	type: "GET",
 	url: "/groups/add_portavoce/<%=@group.id%>",
 	data: "portavoce_id=" + extractId(draggable.attr('id'))
 });

}
		
	$(function() {
		$('.group_partecipant').draggable({
			cursor: 'move',
			containment: 'document',
			revert: true
		});
				
		
		 $('#portavoce_section').droppable( {
		    drop: handleDropEvent
		  } );
	});
	


$(document).ready(function() {
    //Tie a menu to the right click of each row of the table with a class of customerRow
	alert('hei');
    $(".customerRow").contextMenu({ menu: 'myMenu' }, 
        function(action, el, pos) { contextMenuWork(action, el, pos); });

    //Tie a menu the left click of each td with the class of openmenu !Important - requires modified
    //jquery.contextMenu.js that allows for leftButton: true
    $(".openmenu").contextMenu({ menu: 'myMenu', leftButton: true }, 
        function(action, el, pos) { contextMenuWork(action, el.parent("tr"), pos); });

    });

    function contextMenuWork(action, el, pos) {

        switch (action) {
            case "delete":
                {
                    //Popup Delete Confirmation - included in demo and in download
                    break;
                }
            case "insert":
                {
                    //Popup Insert Dialog- included in demo and in download
                    break;
                }

            case "edit":
                {
                    //Popup Edit Dialog
                    break;
                }
        }

   }
</script>