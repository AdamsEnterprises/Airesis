<p>
  <h3><%=h @group.name %></h3>
</p>

<p>
  <%=h @group.description %>
</p>


	<% partecipants = @group.partecipants %>

	<%if partecipants.length > 0 %>
	
	<p>
		<b>Elenco partecipanti al gruppo</b>
		<div id="partecipanti_section" class="portavoce_section" >
		<%partecipants.each do |partecipant| %>
			<div class="group_partecipant" id="partecipant_<%=partecipant.id%>" style="background:lightgray; height:20px; display:inline-block; border:solid 1px; border-radius:5px;padding:5px; box-shadow: 0 1px 5px #CCCCCC;">
			<a onClick="return linkActive;" href="/users/<%=partecipant.id%>"><%= h(partecipant.name) + " " +  h(partecipant.surname)  + "(" + h(partecipant.login) + ")"%></a>
			<span aria-haspopup="true" tabindex="0" title="Opzioni" class="Mo" role="button"></span>
			</div>
		<%end%>				
		</div>			
		
	</p>
	<p>
		<b>Portavoce:</b>
		<%portavoce = @group.portavoce
		if portavoce%>
		<%=@group.portavoce.full_link_to_page%>
		<%else%>
		<div id="portavoce_section" class="portavoce_section" >
		 Questo gruppo non ha ancora un portavoce. Trascina in quest'area un partecipante al gruppo per farlo diventare portavoce...
		</div>
		<%end%>
	</p>
		
	<%else%>
	<p>
		<b>Nessun utente partecipa ancora a questo gruppo.</b>
	</p>
	<%end%>
	
	
	
	<% requests = @group.partecipation_requests.pending
		if requests.size > 0 %>
			<p><b>Elenco delle richieste di partecipazione in attesa di risposta</b></p>
			<%requests.each do |request|%>
				<p><%=request.user.full_link_to_page%>
				<% if ((current_user && (@group.portavoce == current_user)) || is_admin?)%>
					<%if @group.request_by_vote?%>
						<%=link_to 'Accetta la richiesta e procedi con la votazione.', url_for(:action => "partecipation_request_confirm", :controller => "groups", :id => @group.id, :request_id => request.id)%>
					<%elsif @group.request_by_portavoce? %>
						<%=link_to 'Accetta la richiesta.', url_for(:action => "partecipation_request_confirm", :controller => "groups", :id => @group.id, :request_id => request.id)%> 
					<% end%>
				<%end%>
				</p>
	<% 	end%>
		
	<% voting = @group.partecipation_requests.voting
		if voting.size > 0%>
			<p><b>Elenco delle richieste di partecipazione in corso di votazione</b></p>
			<%voting.each do |request|%>
				<p><%=request.user.full_link_to_page%>
				<a>Vota SI</a> - 
				<a>Vota NO</a>
				</p>
			<%end
		end%>	
<% end%>	
	
<% if logged_in? %>		
	<p>
	<% partecipation_request = current_user.has_asked_for_partecipation?(@group.id)  
	if !partecipation_request%>
		<%= link_to 'Richiedi di partecipare a questo gruppo', url_for(:action => "ask_for_partecipation", :controller => "groups", :id => @group.id)%>
	<%else%>
		<b>
		Hai gi√† fatto richiesta di partecipazione a questo gruppo. Stato della richiesta: <%=partecipation_request.status.description%>
		</b>
	<%end%>
	</p>
<%end%>
<p>	


<%= link_to 'Modifica', edit_group_path(@group) if (is_admin?)%>




<% unless @group.posts.empty? %>

  <% @group.posts.each do |post| %>
      <p>
        <%= post.id %>    
      </p>
  <% end %>
<% end %>

<%= link_to 'Indietro', groups_path %>


<script>
	
	var linkActive = false;
	
function extractId(str) {	
	var patt1="_.*";
	return str.match(patt1).toString().substr(1);
}
	
function handleDropEvent( event, ui ) {
  var draggable = ui.draggable;
  /*draggable.draggable( 'disable' );*/
  /*$(this).droppable( 'disable' );*/
  draggable.position( { of: $(this), 
  						my: 'left top', 
						at: 'left top',
						offset: '50 0' } );
  draggable.draggable( 'option', 'revert', false );
  $.ajax({
 	type: "GET",
 	url: "/groups/add_portavoce/<%=@group.id%>",
 	data: "portavoce_id=" + extractId(draggable.attr('id'))
 });

}
		
	$(function() {
		$('.group_partecipant').draggable({
			cursor: 'move',
			containment: 'document',
			revert: true
		});
				
		
		 $('#portavoce_section').droppable( {
		    drop: handleDropEvent
		  } );
	});
	

</script>